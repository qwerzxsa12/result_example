#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <time.h>
#include <string.h>


int n=10000000,m=2,nband=4;
long i,Ncell=950;

double p,z=1.0,tspec,g_bulk,beta,qq;
double c,mp,me,e,pi,sigmaT,hbar,Para_h,dtcom;
double epsilon,dd=7.0/400.0,dtheta = 0.00005;
double C1,r0,R0,B0,bb,log10gm,log10ir0,t_end;
double Edis,LB_0,L_jet, sigma_0, sigma_end,A0,Nrec_tot,t_rec,E_inj_rec,Omega_jet,N_inj_rec;
char *opt;
int option, input_number;

/* 单位转换*/
double Para_Jy2erg, Para_erg2Jy, Para_eV2erg;

double Para_erg2eV,Para_erg2KeV, Para_Day2Second, Para_Year2Second;

double Para_Hz2eV ,Para_Hz2KeV, Para_Hz2MeV, Para_Hz2GeV;
double Para_GeV2Hz, Para_MeV2Hz, Para_KeV2Hz, Para_eV2Hz;

/* ------ define the functions to be used ------ */
float min(float a, float b)
{
    if(a<b) return a;
    else return b;
}

void linspace(double x1, double x2, int n, double *y)
{
    int i = 0;
    double d = (x2 - x1)/(n-1);
    
    for(i = 0; i<n; i++)
    {
       y[i] = x1 + i*d;
    }
    
}

void logspace(double x1, double x2, int n, double *y)
{
    int i = 0;
    double d = pow(10.0, (x2 - x1)/(n-1));
    
    for(i = 0; i<n; i++)
    {
       y[i] = pow(10.0, x1)*pow(d,i);
    }
    
}

int my_strnicmp(const char *dst,const char *src,int count)

{

   int ch1, ch2;

   do

   {

      if ( ((ch1 = (unsigned char)(*(dst++))) >= 'A') &&(ch1 <= 'Z') )

        ch1 += 0x20;

      if ( ((ch2 = (unsigned char)(*(src++))) >= 'A') &&(ch2 <= 'Z') )

        ch2 += 0x20;

   } while ( --count && ch1 && (ch1 == ch2) );

   return (ch1 - ch2);

}



char *space_del(char *str)   /* 去掉字符串中的空格*/
{
    char *str_c=str;
    int i,j=0;
    for(i=0;str[i]!='\0';i++)
    {
        if(str[i]!=' ')
            str_c[j++]=str[i];
    }
    str_c[j]='\0';
    str=str_c;
    return str;
}




double N_rec(double t)
{   if(option == 2)
    {   if (t<=t_end ) return exp(t/t_rec);
       else  return 0.0;
    }
    else
    if(option == 3)
    {  if (t<=t_end )
       {return pow((1.0+t/t_rec), qq);}
    else return 0.0;
    }
    else
        return 0.0;
}

double B_decay(double t)
{   double BB;
    if(option == 1)
    {BB = B0*pow(((g_bulk*c*t)/R0), -bb);}
    else
    if(option == 2)
      {
        if(t <= t_end)
      {BB = sqrt((LB_0 - Edis*t_rec*(exp(t/t_rec) -1.0)/Nrec_tot)/(g_bulk*g_bulk*pow(R0 + g_bulk*c*t,2.0)*c*Omega_jet));}
        else BB = sqrt((LB_0 - Edis)/(g_bulk*g_bulk*pow(R0 + g_bulk*c*t,2.0)*c*Omega_jet));
        }
    else
    if(option == 3)
       {  if(t <= t_end)
          {
           BB = sqrt((LB_0 - Edis*t_rec/(qq+1.0)*pow(1.0 + t/t_rec, qq+1)/Nrec_tot)/(g_bulk*g_bulk*pow(R0 + g_bulk*c*t,2.0)*c*Omega_jet));
           
           }
           else  BB =sqrt((LB_0 - Edis)/(g_bulk*g_bulk*pow(R0 + g_bulk*c*t,2.0)*c*Omega_jet));
       }
 
    return BB;
}

double g_x_t(double x, double B, double t)
{
    return C1*pow(B,2.0)*pow(x, 2.0) - (x*g_bulk*c*2.0/(3.0*(R0+g_bulk*c*t)))*(bb != 0);
}
double h1(double tcom, double B)  /* step size varying */
{
    return fabs(6.0/400.0*log(10.0)/(C1*pow(10.0,8.0)*pow(B,1.5) - 2.0*(g_bulk*c)/(3.0*(R0+ g_bulk*c*tcom))*(bb != 0)));
}

double Lcdm(double zprime)
{
   double Omega_matter=0.27;
   double Omega_lambda=0.73;

   return 1.0/sqrt(Omega_matter*pow(1.0+zprime,3.0)+Omega_lambda);
}

double Dop(double theta)
{
    return(1.0/(g_bulk*(1.0- pow(1.0-1.0/pow(g_bulk, 2.0), 0.5)*cos(theta))));
}

int findindex(double *a, double tofind, int length)
{
    int i;
    for(i = 0; i<length; i++)
        {
            if(a[i] >= tofind) break;
        }
    return i;
}



double Qx(double x, double t, double tobs)
{
if(option == 1) return pow(10.0, log10ir0)*pow(tobs/2.0, qq)*pow((x/pow(10.0,log10gm)), -p);
else
if(option == 2)
   {
    double Nrec;
    Nrec = N_rec(t);
    return A0*Nrec*pow(x, -p);
   }
else
if(option == 3)
    {
    double Nrec;
    Nrec = N_rec(t);
    return A0*Nrec*pow(x, -p);

    }
else
    return 0.0;

}



/* define a function 'Alloc' to declare 2d arrays on Heap, not on Stack */

double **Alloc(int n,int m)
{
   double **pt;
   double *buf;
   pt=(double **) malloc(n*sizeof(double *));
   buf=(double *) malloc(n*m*sizeof(double));
   for(i=0;i<n;i++) pt[i]=&buf[i*m];
   return pt;
}


/* define a function 'alloc1' to declare 1d arrays on Heap, not on Stack */

double *alloc1(int m)
{
   double *pt;
   pt=(double *) malloc(m*sizeof(double));
   return pt;
}


/* =================================================== */


int main(int argc, char *argv[])
{
   int loop,i_t;
   int j2,j5,j5max,jm,theta_length,j_u[2],th1;

   double x[2],r[2],log10r[2],hh;
   double t[2],log10t[2],tobs[2],log10tobs[2],*tcom;
   double gb[2],vb[2],g_u[2],ges_u[2];

   double D,DD,nuobs[50000],log10nuobs[50000],theta[50000],IC,IC_tilde,inge[2];
   double *dN,*ginj,B[2],rad_cool,adia_cool,inj_rate,theta_jet,L_w,Omega_jet_LOS;
   double tobs_end, tobs_start, tobs_end_M,tobs_start_M,theta_jet_LOS,theta_up_lim;
   double theta_grid_end, dt_Ea;
   double ges[400],log10ges[400],Do[50000],t_p_Ea_M[50000];

   double *F,*N_inj,**ne,**ne_EA,**nup,**log10nup,nucobs,nu_c,nu_tem,dt,tcom_spec;
   double dFnumax,dFnu_tem,dFnu,Fnuobs,g_min, g_max,log10g_max,dg;
    double l_rec,v_rec,log10L_jet,log10lrec,log10R0;

   long i0;
   double log10xxmax,log10xxmin,log10xx_tem;
   double k1,k2,k3,k4;
   // double log10xx[Ncell+1],Fxx[Ncell+1];


/* open up the files to be used */

   // FILE *in1;
   // in1=fopen("./Fx.txt","r");

    /* give the constants their numerical values */

    c=2.997925*pow(10.0,10.0);
    mp=1.67*pow(10.0,-24.0);
    me=9.1095*pow(10.0,-28.0);
    e=4.8032*pow(10.0,-10.0);
    sigmaT=0.665*pow(10.0,-24.0);
    pi=3.141592;
    hbar=1.054572*pow(10.0,-27.0);
    Para_h = 6.627e-27;
    epsilon= pow(10.0, -9.0);
    C1=-sigmaT/(6*pi*me*c);
    r0=pow(10.0,14.0);
    sigma_0 = 100.0;
    v_rec = 0.1*c;
   
    
    Para_Jy2erg=pow(10.0 , -23.0),Para_erg2Jy=1.0/Para_Jy2erg, Para_eV2erg=1.602*pow(10.0, -12.0);
    Para_erg2eV=1.0/Para_eV2erg,Para_erg2KeV=pow(10.0,-3.0)*Para_erg2eV, Para_Day2Second=24.0*3600.0, Para_Year2Second=365.0*Para_Day2Second;
    Para_Hz2eV=Para_h*Para_erg2eV ,Para_Hz2KeV=Para_h*Para_erg2KeV, Para_Hz2MeV=pow(10.0,-3.0)*Para_Hz2KeV, Para_Hz2GeV=pow(10.0,-3.0)*Para_Hz2MeV;
    Para_GeV2Hz=1.0/Para_Hz2GeV, Para_MeV2Hz=1.0/Para_Hz2MeV, Para_KeV2Hz=1.0/Para_Hz2KeV, Para_eV2Hz=1.0/Para_Hz2eV;
/* input the parameters of the model */
   // double temp = strtod(argv[1],NULL);
    char * ftemp1 = argv[1];
    opt=ftemp1;
    opt = space_del(opt);
    /*printf("opt = %s\n", opt);
    printf("%d\n",(int) my_strnicmp(opt,"Lucas",strlen("Lucas")) == 0);*/
    
    if((int) my_strnicmp(opt,"Lucas",strlen("Lucas")) == 0 )
    {
        option = 1;
    }
    else
    if((int) my_strnicmp(opt,"Liu_exp",strlen("Liu_exp")) == 0 )
    {
        option = 2;
    }
    else
    if((int) my_strnicmp(opt,"Liu_PL",strlen("Liu_PL"))==0)
    {
        option = 3;
    }
    else option = 100;
    


  
    
/*input parameters of Lucas*/
if(option == 1)
{   float ftemp2 = atof(argv[2]);
    g_bulk=ftemp2;
    float ftemp3 = atof(argv[3]);
    p=ftemp3;
    float ftemp4 = atof(argv[4]);
    log10gm=ftemp4;
    float ftemp5 = atof(argv[5]);
    log10ir0=ftemp5;
    float ftemp6 = atof(argv[6]);
    qq=ftemp6;
    float ftemp7 = atof(argv[7]);
    B0=ftemp7;
    float ftemp8 = atof(argv[8]);
    bb=ftemp8;
    float ftemp9 = atof(argv[9]);
    tspec=ftemp9;
    R0=pow(10.0,14.0);
    input_number = 11;
    
}
   
else
if(option == 2)
{
    float ftemp2 = atof(argv[2]);
    g_bulk=ftemp2;
    float ftemp3 = atof(argv[3]);
    p=ftemp3;
    float ftemp4 = atof(argv[4]);
    log10gm=ftemp4;
    float ftemp5 = atof(argv[5]);
    tspec=ftemp5;
    float ftemp6 = atof(argv[6]);
    log10lrec = ftemp6;
    float ftemp7 = atof(argv[7]);
    log10R0 = ftemp7;
    float ftemp8 = atof(argv[8]);
    log10L_jet = ftemp8;
    float ftemp9 = atof(argv[9]);
    sigma_end=ftemp9;
    bb = 1.0;
    input_number = 11;
    }

else
if(option == 3)
{
   float ftemp2 = atof(argv[2]);
   g_bulk=ftemp2;
   float ftemp3 = atof(argv[3]);
   p=ftemp3;
   float ftemp4 = atof(argv[4]);
   log10gm=ftemp4;
   float ftemp5= atof(argv[5]);
   qq=ftemp5;
   float ftemp6 = atof(argv[6]);
   tspec=ftemp6;
   float ftemp7 = atof(argv[7]);
   log10lrec = ftemp7;
   float ftemp8 = atof(argv[8]);
   log10R0 = ftemp8;
   float ftemp9 = atof(argv[9]);
   log10L_jet = ftemp9;
   float ftemp10 = atof(argv[10]);
   sigma_end=ftemp10;
   bb = 1.0;
   input_number = 12;
}
   /* printf("%d\n",option);*/
    
    /* give the variable constants their numerical values */
    
    R0 = pow(10.0, log10R0);
    g_min = pow(10.0, log10gm);
    beta = sqrt(1-1/pow(g_bulk,2));
    theta_jet = 1.0/g_bulk;
    Omega_jet = 2.0*pi*(1.0 - cos(theta_jet));
    if(option == 2 || option == 3 )
    {
    L_jet = pow(10.0, log10L_jet);
    l_rec = pow(10.0, log10lrec);
    t_rec = l_rec/v_rec;
    L_w = L_jet*Omega_jet/4.0/pi;
    LB_0 = L_w*sigma_0/(1+sigma_0);
    Edis = L_w*(sigma_0 - sigma_end)/(sigma_0 +  1.0);
    Nrec_tot = 0.1*pi*pow(R0, 3.0)/(pow(g_bulk,3.0)*pow(l_rec, 3.0));
    B0 = sqrt(L_w/(pow(g_bulk, 2.0)*pow(R0, 2.0)*c*Omega_jet));
        if(option == 2) t_end = log(Nrec_tot*LB_0/Edis/t_rec+1.0)*t_rec;
            
        if(option == 3) t_end=((pow((qq+1.0)*Nrec_tot/t_rec+1.0,(1.0/(qq+1.0)))-1.0)*t_rec);/*结束时间指数形式*/
        tobs_end = t_end/2.0/g_bulk;
        tobs_start = t_end/1000.0;
        tobs_start_M = tobs_end*(1.0+z)/100.0;
        tobs_end_M = tobs_end*(1.0+z)*10.0;
        
    /*LOS参考系下立体角网格划分*/
    theta_jet_LOS = 5.0/360.0*2.0*pi;
    Omega_jet_LOS = 2.0*pi*(1.0-cos(theta_jet));
    theta_up_lim=acos(1.0-tobs_end_M/(1.0+z)*c/R0);
    theta_grid_end = min(theta_jet_LOS, theta_up_lim);
    theta[0] = 0.0;
    }
    else  theta_grid_end = 5.0/360.0*2.0*pi;
    
    for(th1=0;th1<50000;th1++)
    {
        theta[th1+1] = theta[th1] + dtheta;
        t_p_Ea_M[th1] = beta*tspec/((1+z)*g_bulk*(1-beta*cos(theta[th1])));
        if(theta[th1]>theta_grid_end) break;
        theta_length=th1;
       
    }
   
    
    
    for(th1 = 0; th1<theta_length; th1++)
    {
        Do[th1] = 1.0/(g_bulk*(1-beta*cos(theta[th1])));

    }
/* assign the alloc1 function to each 1d array */
   
    tcom=alloc1(n),dN=alloc1(n),ginj=alloc1(n), F = alloc1(n);
    

/* assign the Alloc function to each 2d array */
  nup = Alloc(argc-input_number+1, theta_length);

   
   float ftem[50000];
    for(j2=0;j2<=argc-input_number;j2++)
   {
      ftem[j2] = atof(argv[j2+input_number-1]);
      log10nuobs[j2] = ftem[j2];
      nuobs[j2]=pow(10.0,log10nuobs[j2]);
      for(th1=0;th1<theta_length;th1++)
      {
          nup[j2][th1] = nuobs[j2]*(1.0+z)/Do[th1];
         
          
      }

   }
    
    if(option == 100)  goto wrong;

    
   
   // p=argv[2];
   // log10ginj=argv[3];
   // log10ir0=argv[4];
   // qq=argv[5];
   // B0=argv[6];
   // bb=argv[7];
   // tspec=argv[8];
   // log10nuobs=argv[9];

   // printf("Input the bulk Lorentz factor, Gamma:\n");
   // scanf("%lf",&g_bulk);

   // printf("Input the power-law index of the injected electron spectrum, p:\n");
   // scanf("%lf",&p);

   // printf("Input the injection Lorentz factor of the electrons, log10ginj:\n");
   // scanf("%lf",&log10ginj);

   // printf("Input the normalization parameter of the electron injection rate, log10inj_rate_0:\n");
   // scanf("%lf",&log10ir0);

   // printf("Input the power-law exponent of the electron injection rate, q:\n");
   // scanf("%lf",&qq);

   // printf("Input the normalization parameter of the B field, B0:\n");
   // scanf("%lf",&B0);

   // printf("Input the power-law exponent of the B profile, b:\n");
   // scanf("%lf",&bb);

   // printf("Input the observer time for which the code produces the spectral flux:\n");
   // scanf("%lf",&tspec);

   // printf("Input the observed frequency for which the code produces the spectral flux, log10nuobs:\n");
   // scanf("%lf",&log10nuobs);


/* luminosity distance to the burst */

   D=2.6*pow(10.0,28.0)*(1.0+z-sqrt(1.0+z)); /* flat, matter-dominated universe */

   D=0.0;
   for(i=1;i<1000*20;i++) /* Lambda-CDM cosmology, flat universe */
   {
      if(0.001*i>z) break;
      D=D+Lcdm(0.001*i)*0.001;
   }
  
   D=1.303*pow(10.0,28.0)*(1.0+z)*D;
    
    for(i = 1; i<1000; i++)  /*等时面积分*/
   {
       if(0.0001*i>5.0*pi/180) break;
       DD = DD + Dop(0.0001*i)*0.0001;
       }
    DD = pi*DD;
/* make a grid for electron spectra: gamma_e in units of gamma_{inj} */
    
   g_max = pow(10.0, 8.0)*pow(B0, -0.5);
   log10g_max = log10(g_max);
   log10ges[0] = 1.0;
   for(j5=1;j5<n;j5++)
   {
      log10ges[j5]=log10ges[j5-1]+dd;
      if(log10ges[j5] > log10g_max) break;
      j5max=j5;
       
   }
    ne = Alloc(2,j5max), N_inj = alloc1(j5max), ne_EA = Alloc(50000, j5max);
   /*printf("%le\n%d\n",log10ges[j5],j5max);*/
    
    
/*manetic reconnection*/
    A0 = 0.0;
    E_inj_rec = 0.0;
   for(j5=0;j5<=j5max;j5++)
   {
       ges[j5]=pow(10.0,log10ges[j5]);
       N_inj[j5] = pow(ges[j5],-p)*((ges[j5]<g_max)&(ges[j5]>g_min));
       A0 = A0 + N_inj[j5]*ges[j5]*me*c*c*dd*log(10.0)*ges[j5];

   }
   
    A0  = 0.5*Edis/(Nrec_tot*A0);
   
    for(j5=0;j5<=j5max;j5++)
    {
        N_inj[j5] = A0*N_inj[j5];
        E_inj_rec = E_inj_rec + N_inj[j5]*ges[j5]*me*c*c*dd*log(10.0)*ges[j5];
    }
   
/* number of electrons between ginj*ges[j5-1] and ginj*ges[j5] in units of dN[i] */

   

/* read from Fx.txt; the synchrotron function F(x) on a logarithmic grid x */

   // for(i=0;i<=Ncell;i++) fscanf(in1,"%lf  %le",&(log10xx[i]),&(Fxx[i]));

double log10xx[951]={-8.000000 ,-7.990000 ,-7.980000 ,-7.970000 ,-7.960000 ,-7.950000 ,-7.940000 ,-7.930000 ,-7.920000 ,-7.910000 ,-7.900000 ,-7.890000 ,-7.880000 ,-7.870000 ,-7.860000 ,-7.850000 ,-7.840000 ,-7.830000 ,-7.820000 ,-7.810000 ,-7.800000 ,-7.790000 ,-7.780000 ,-7.770000 ,-7.760000 ,-7.750000 ,-7.740000 ,-7.730000 ,-7.720000 ,-7.710000 ,-7.700000 ,-7.690000 ,-7.680000 ,-7.670000 ,-7.660000 ,-7.650000 ,-7.640000 ,-7.630000 ,-7.620000 ,-7.610000 ,-7.600000 ,-7.590000 ,-7.580000 ,-7.570000 ,-7.560000 ,-7.550000 ,-7.540000 ,-7.530000 ,-7.520000 ,-7.510000 ,-7.500000 ,-7.490000 ,-7.480000 ,-7.470000 ,-7.460000 ,-7.450000 ,-7.440000 ,-7.430000 ,-7.420000 ,-7.410000 ,-7.400000 ,-7.390000 ,-7.380000 ,-7.370000 ,-7.360000 ,-7.350000 ,-7.340000 ,-7.330000 ,-7.320000 ,-7.310000 ,-7.300000 ,-7.290000 ,-7.280000 ,-7.270000 ,-7.260000 ,-7.250000 ,-7.240000 ,-7.230000 ,-7.220000 ,-7.210000 ,-7.200000 ,-7.190000 ,-7.180000 ,-7.170000 ,-7.160000 ,-7.150000 ,-7.140000 ,-7.130000 ,-7.120000 ,-7.110000 ,-7.100000 ,-7.090000 ,-7.080000 ,-7.070000 ,-7.060000 ,-7.050000 ,-7.040000 ,-7.030000 ,-7.020000 ,-7.010000 ,-7.000000 ,-6.990000 ,-6.980000 ,-6.970000 ,-6.960000 ,-6.950000 ,-6.940000 ,-6.930000 ,-6.920000 ,-6.910000 ,-6.900000 ,-6.890000 ,-6.880000 ,-6.870000 ,-6.860000 ,-6.850000 ,-6.840000 ,-6.830000 ,-6.820000 ,-6.810000 ,-6.800000 ,-6.790000 ,-6.780000 ,-6.770000 ,-6.760000 ,-6.750000 ,-6.740000 ,-6.730000 ,-6.720000 ,-6.710000 ,-6.700000 ,-6.690000 ,-6.680000 ,-6.670000 ,-6.660000 ,-6.650000 ,-6.640000 ,-6.630000 ,-6.620000 ,-6.610000 ,-6.600000 ,-6.590000 ,-6.580000 ,-6.570000 ,-6.560000 ,-6.550000 ,-6.540000 ,-6.530000 ,-6.520000 ,-6.510000 ,-6.500000 ,-6.490000 ,-6.480000 ,-6.470000 ,-6.460000 ,-6.450000 ,-6.440000 ,-6.430000 ,-6.420000 ,-6.410000 ,-6.400000 ,-6.390000 ,-6.380000 ,-6.370000 ,-6.360000 ,-6.350000 ,-6.340000 ,-6.330000 ,-6.320000 ,-6.310000 ,-6.300000 ,-6.290000 ,-6.280000 ,-6.270000 ,-6.260000 ,-6.250000 ,-6.240000 ,-6.230000 ,-6.220000 ,-6.210000 ,-6.200000 ,-6.190000 ,-6.180000 ,-6.170000 ,-6.160000 ,-6.150000 ,-6.140000 ,-6.130000 ,-6.120000 ,-6.110000 ,-6.100000 ,-6.090000 ,-6.080000 ,-6.070000 ,-6.060000 ,-6.050000 ,-6.040000 ,-6.030000 ,-6.020000 ,-6.010000 ,-6.000000 ,-5.990000 ,-5.980000 ,-5.970000 ,-5.960000 ,-5.950000 ,-5.940000 ,-5.930000 ,-5.920000 ,-5.910000 ,-5.900000 ,-5.890000 ,-5.880000 ,-5.870000 ,-5.860000 ,-5.850000 ,-5.840000 ,-5.830000 ,-5.820000 ,-5.810000 ,-5.800000 ,-5.790000 ,-5.780000 ,-5.770000 ,-5.760000 ,-5.750000 ,-5.740000 ,-5.730000 ,-5.720000 ,-5.710000 ,-5.700000 ,-5.690000 ,-5.680000 ,-5.670000 ,-5.660000 ,-5.650000 ,-5.640000 ,-5.630000 ,-5.620000 ,-5.610000 ,-5.600000 ,-5.590000 ,-5.580000 ,-5.570000 ,-5.560000 ,-5.550000 ,-5.540000 ,-5.530000 ,-5.520000 ,-5.510000 ,-5.500000 ,-5.490000 ,-5.480000 ,-5.470000 ,-5.460000 ,-5.450000 ,-5.440000 ,-5.430000 ,-5.420000 ,-5.410000 ,-5.400000 ,-5.390000 ,-5.380000 ,-5.370000 ,-5.360000 ,-5.350000 ,-5.340000 ,-5.330000 ,-5.320000 ,-5.310000 ,-5.300000 ,-5.290000 ,-5.280000 ,-5.270000 ,-5.260000 ,-5.250000 ,-5.240000 ,-5.230000 ,-5.220000 ,-5.210000 ,-5.200000 ,-5.190000 ,-5.180000 ,-5.170000 ,-5.160000 ,-5.150000 ,-5.140000 ,-5.130000 ,-5.120000 ,-5.110000 ,-5.100000 ,-5.090000 ,-5.080000 ,-5.070000 ,-5.060000 ,-5.050000 ,-5.040000 ,-5.030000 ,-5.020000 ,-5.010000 ,-5.000000 ,-4.990000 ,-4.980000 ,-4.970000 ,-4.960000 ,-4.950000 ,-4.940000 ,-4.930000 ,-4.920000 ,-4.910000 ,-4.900000 ,-4.890000 ,-4.880000 ,-4.870000 ,-4.860000 ,-4.850000 ,-4.840000 ,-4.830000 ,-4.820000 ,-4.810000 ,-4.800000 ,-4.790000 ,-4.780000 ,-4.770000 ,-4.760000 ,-4.750000 ,-4.740000 ,-4.730000 ,-4.720000 ,-4.710000 ,-4.700000 ,-4.690000 ,-4.680000 ,-4.670000 ,-4.660000 ,-4.650000 ,-4.640000 ,-4.630000 ,-4.620000 ,-4.610000 ,-4.600000 ,-4.590000 ,-4.580000 ,-4.570000 ,-4.560000 ,-4.550000 ,-4.540000 ,-4.530000 ,-4.520000 ,-4.510000 ,-4.500000 ,-4.490000 ,-4.480000 ,-4.470000 ,-4.460000 ,-4.450000 ,-4.440000 ,-4.430000 ,-4.420000 ,-4.410000 ,-4.400000 ,-4.390000 ,-4.380000 ,-4.370000 ,-4.360000 ,-4.350000 ,-4.340000 ,-4.330000 ,-4.320000 ,-4.310000 ,-4.300000 ,-4.290000 ,-4.280000 ,-4.270000 ,-4.260000 ,-4.250000 ,-4.240000 ,-4.230000 ,-4.220000 ,-4.210000 ,-4.200000 ,-4.190000 ,-4.180000 ,-4.170000 ,-4.160000 ,-4.150000 ,-4.140000 ,-4.130000 ,-4.120000 ,-4.110000 ,-4.100000 ,-4.090000 ,-4.080000 ,-4.070000 ,-4.060000 ,-4.050000 ,-4.040000 ,-4.030000 ,-4.020000 ,-4.010000 ,-4.000000 ,-3.990000 ,-3.980000 ,-3.970000 ,-3.960000 ,-3.950000 ,-3.940000 ,-3.930000 ,-3.920000 ,-3.910000 ,-3.900000 ,-3.890000 ,-3.880000 ,-3.870000 ,-3.860000 ,-3.850000 ,-3.840000 ,-3.830000 ,-3.820000 ,-3.810000 ,-3.800000 ,-3.790000 ,-3.780000 ,-3.770000 ,-3.760000 ,-3.750000 ,-3.740000 ,-3.730000 ,-3.720000 ,-3.710000 ,-3.700000 ,-3.690000 ,-3.680000 ,-3.670000 ,-3.660000 ,-3.650000 ,-3.640000 ,-3.630000 ,-3.620000 ,-3.610000 ,-3.600000 ,-3.590000 ,-3.580000 ,-3.570000 ,-3.560000 ,-3.550000 ,-3.540000 ,-3.530000 ,-3.520000 ,-3.510000 ,-3.500000 ,-3.490000 ,-3.480000 ,-3.470000 ,-3.460000 ,-3.450000 ,-3.440000 ,-3.430000 ,-3.420000 ,-3.410000 ,-3.400000 ,-3.390000 ,-3.380000 ,-3.370000 ,-3.360000 ,-3.350000 ,-3.340000 ,-3.330000 ,-3.320000 ,-3.310000 ,-3.300000 ,-3.290000 ,-3.280000 ,-3.270000 ,-3.260000 ,-3.250000 ,-3.240000 ,-3.230000 ,-3.220000 ,-3.210000 ,-3.200000 ,-3.190000 ,-3.180000 ,-3.170000 ,-3.160000 ,-3.150000 ,-3.140000 ,-3.130000 ,-3.120000 ,-3.110000 ,-3.100000 ,-3.090000 ,-3.080000 ,-3.070000 ,-3.060000 ,-3.050000 ,-3.040000 ,-3.030000 ,-3.020000 ,-3.010000 ,-3.000000 ,-2.990000 ,-2.980000 ,-2.970000 ,-2.960000 ,-2.950000 ,-2.940000 ,-2.930000 ,-2.920000 ,-2.910000 ,-2.900000 ,-2.890000 ,-2.880000 ,-2.870000 ,-2.860000 ,-2.850000 ,-2.840000 ,-2.830000 ,-2.820000 ,-2.810000 ,-2.800000 ,-2.790000 ,-2.780000 ,-2.770000 ,-2.760000 ,-2.750000 ,-2.740000 ,-2.730000 ,-2.720000 ,-2.710000 ,-2.700000 ,-2.690000 ,-2.680000 ,-2.670000 ,-2.660000 ,-2.650000 ,-2.640000 ,-2.630000 ,-2.620000 ,-2.610000 ,-2.600000 ,-2.590000 ,-2.580000 ,-2.570000 ,-2.560000 ,-2.550000 ,-2.540000 ,-2.530000 ,-2.520000 ,-2.510000 ,-2.500000 ,-2.490000 ,-2.480000 ,-2.470000 ,-2.460000 ,-2.450000 ,-2.440000 ,-2.430000 ,-2.420000 ,-2.410000 ,-2.400000 ,-2.390000 ,-2.380000 ,-2.370000 ,-2.360000 ,-2.350000 ,-2.340000 ,-2.330000 ,-2.320000 ,-2.310000 ,-2.300000 ,-2.290000 ,-2.280000 ,-2.270000 ,-2.260000 ,-2.250000 ,-2.240000 ,-2.230000 ,-2.220000 ,-2.210000 ,-2.200000 ,-2.190000 ,-2.180000 ,-2.170000 ,-2.160000 ,-2.150000 ,-2.140000 ,-2.130000 ,-2.120000 ,-2.110000 ,-2.100000 ,-2.090000 ,-2.080000 ,-2.070000 ,-2.060000 ,-2.050000 ,-2.040000 ,-2.030000 ,-2.020000 ,-2.010000 ,-2.000000 ,-1.990000 ,-1.980000 ,-1.970000 ,-1.960000 ,-1.950000 ,-1.940000 ,-1.930000 ,-1.920000 ,-1.910000 ,-1.900000 ,-1.890000 ,-1.880000 ,-1.870000 ,-1.860000 ,-1.850000 ,-1.840000 ,-1.830000 ,-1.820000 ,-1.810000 ,-1.800000 ,-1.790000 ,-1.780000 ,-1.770000 ,-1.760000 ,-1.750000 ,-1.740000 ,-1.730000 ,-1.720000 ,-1.710000 ,-1.700000 ,-1.690000 ,-1.680000 ,-1.670000 ,-1.660000 ,-1.650000 ,-1.640000 ,-1.630000 ,-1.620000 ,-1.610000 ,-1.600000 ,-1.590000 ,-1.580000 ,-1.570000 ,-1.560000 ,-1.550000 ,-1.540000 ,-1.530000 ,-1.520000 ,-1.510000 ,-1.500000 ,-1.490000 ,-1.480000 ,-1.470000 ,-1.460000 ,-1.450000 ,-1.440000 ,-1.430000 ,-1.420000 ,-1.410000 ,-1.400000 ,-1.390000 ,-1.380000 ,-1.370000 ,-1.360000 ,-1.350000 ,-1.340000 ,-1.330000 ,-1.320000 ,-1.310000 ,-1.300000 ,-1.290000 ,-1.280000 ,-1.270000 ,-1.260000 ,-1.250000 ,-1.240000 ,-1.230000 ,-1.220000 ,-1.210000 ,-1.200000 ,-1.190000 ,-1.180000 ,-1.170000 ,-1.160000 ,-1.150000 ,-1.140000 ,-1.130000 ,-1.120000 ,-1.110000 ,-1.100000 ,-1.090000 ,-1.080000 ,-1.070000 ,-1.060000 ,-1.050000 ,-1.040000 ,-1.030000 ,-1.020000 ,-1.010000 ,-1.000000 ,-0.990000 ,-0.980000 ,-0.970000 ,-0.960000 ,-0.950000 ,-0.940000 ,-0.930000 ,-0.920000 ,-0.910000 ,-0.900000 ,-0.890000 ,-0.880000 ,-0.870000 ,-0.860000 ,-0.850000 ,-0.840000 ,-0.830000 ,-0.820000 ,-0.810000 ,-0.800000 ,-0.790000 ,-0.780000 ,-0.770000 ,-0.760000 ,-0.750000 ,-0.740000 ,-0.730000 ,-0.720000 ,-0.710000 ,-0.700000 ,-0.690000 ,-0.680000 ,-0.670000 ,-0.660000 ,-0.650000 ,-0.640000 ,-0.630000 ,-0.620000 ,-0.610000 ,-0.600000 ,-0.590000 ,-0.580000 ,-0.570000 ,-0.560000 ,-0.550000 ,-0.540000 ,-0.530000 ,-0.520000 ,-0.510000 ,-0.500000 ,-0.490000 ,-0.480000 ,-0.470000 ,-0.460000 ,-0.450000 ,-0.440000 ,-0.430000 ,-0.420000 ,-0.410000 ,-0.400000 ,-0.390000 ,-0.380000 ,-0.370000 ,-0.360000 ,-0.350000 ,-0.340000 ,-0.330000 ,-0.320000 ,-0.310000 ,-0.300000 ,-0.290000 ,-0.280000 ,-0.270000 ,-0.260000 ,-0.250000 ,-0.240000 ,-0.230000 ,-0.220000 ,-0.210000 ,-0.200000 ,-0.190000 ,-0.180000 ,-0.170000 ,-0.160000 ,-0.150000 ,-0.140000 ,-0.130000 ,-0.120000 ,-0.110000 ,-0.100000 ,-0.090000 ,-0.080000 ,-0.070000 ,-0.060000 ,-0.050000 ,-0.040000 ,-0.030000 ,-0.020000 ,-0.010000 ,0.000000  ,0.010000  ,0.020000  ,0.030000  ,0.040000  ,0.050000  ,0.060000  ,0.070000  ,0.080000  ,0.090000  ,0.100000  ,0.110000  ,0.120000  ,0.130000  ,0.140000  ,0.150000  ,0.160000  ,0.170000  ,0.180000  ,0.190000  ,0.200000  ,0.210000  ,0.220000  ,0.230000  ,0.240000  ,0.250000  ,0.260000  ,0.270000  ,0.280000  ,0.290000  ,0.300000  ,0.310000  ,0.320000  ,0.330000  ,0.340000  ,0.350000  ,0.360000  ,0.370000  ,0.380000  ,0.390000  ,0.400000  ,0.410000  ,0.420000  ,0.430000  ,0.440000  ,0.450000  ,0.460000  ,0.470000  ,0.480000  ,0.490000  ,0.500000  ,0.510000  ,0.520000  ,0.530000  ,0.540000  ,0.550000  ,0.560000  ,0.570000  ,0.580000  ,0.590000  ,0.600000  ,0.610000  ,0.620000  ,0.630000  ,0.640000  ,0.650000  ,0.660000  ,0.670000  ,0.680000  ,0.690000  ,0.700000  ,0.710000  ,0.720000  ,0.730000  ,0.740000  ,0.750000  ,0.760000  ,0.770000  ,0.780000  ,0.790000  ,0.800000  ,0.810000  ,0.820000  ,0.830000  ,0.840000  ,0.850000  ,0.860000  ,0.870000  ,0.880000  ,0.890000  ,0.900000  ,0.910000  ,0.920000  ,0.930000  ,0.940000  ,0.950000  ,0.960000  ,0.970000  ,0.980000  ,0.990000  ,1.000000  ,1.010000  ,1.020000  ,1.030000  ,1.040000  ,1.050000  ,1.060000  ,1.070000  ,1.080000  ,1.090000  ,1.100000  ,1.110000  ,1.120000  ,1.130000  ,1.140000  ,1.150000  ,1.160000  ,1.170000  ,1.180000  ,1.190000  ,1.200000  ,1.210000  ,1.220000  ,1.230000  ,1.240000  ,1.250000  ,1.260000  ,1.270000  ,1.280000  ,1.290000  ,1.300000  ,1.310000  ,1.320000  ,1.330000  ,1.340000  ,1.350000  ,1.360000  ,1.370000  ,1.380000  ,1.390000  ,1.400000  ,1.410000  ,1.420000  ,1.430000  ,1.440000  ,1.450000  ,1.460000  ,1.470000  ,1.480000  ,1.490000  ,1.500000 };
double Fxx[951]={ 4.631000e-03, 4.666681e-03, 4.702636e-03, 4.738869e-03, 4.775381e-03, 4.812174e-03, 4.849251e-03, 4.886613e-03, 4.924263e-03, 4.962203e-03, 5.000436e-03, 5.038963e-03, 5.077787e-03, 5.116910e-03, 5.156334e-03, 5.196062e-03, 5.236097e-03, 5.276439e-03, 5.317093e-03, 5.358060e-03, 5.399342e-03, 5.440943e-03, 5.482864e-03, 5.525108e-03, 5.567677e-03, 5.610574e-03, 5.653802e-03, 5.697363e-03, 5.741260e-03, 5.785495e-03, 5.830070e-03, 5.874989e-03, 5.920254e-03, 5.965868e-03, 6.011834e-03, 6.058153e-03, 6.104829e-03, 6.151865e-03, 6.199264e-03, 6.247027e-03, 6.295159e-03, 6.343661e-03, 6.392537e-03, 6.441790e-03, 6.491422e-03, 6.541436e-03, 6.591836e-03, 6.642624e-03, 6.693803e-03, 6.745377e-03, 6.797348e-03, 6.849719e-03, 6.902494e-03, 6.955676e-03, 7.009267e-03, 7.063271e-03, 7.117691e-03, 7.172531e-03, 7.227793e-03, 7.283480e-03, 7.339597e-03, 7.396146e-03, 7.453131e-03, 7.510555e-03, 7.568421e-03, 7.626733e-03, 7.685494e-03, 7.744708e-03, 7.804379e-03, 7.864508e-03, 7.925102e-03, 7.986162e-03, 8.047692e-03, 8.109697e-03, 8.172179e-03, 8.235142e-03, 8.298591e-03, 8.362528e-03, 8.426959e-03, 8.491885e-03, 8.557312e-03, 8.623242e-03, 8.689681e-03, 8.756631e-03, 8.824098e-03, 8.892084e-03, 8.960594e-03, 9.029631e-03, 9.099201e-03, 9.169306e-03, 9.239952e-03, 9.311142e-03, 9.382880e-03, 9.455171e-03, 9.528019e-03, 9.601428e-03, 9.675403e-03, 9.749948e-03, 9.825067e-03, 9.900764e-03, 9.977045e-03, 1.005391e-02, 1.013137e-02, 1.020943e-02, 1.028809e-02, 1.036735e-02, 1.044723e-02, 1.052772e-02, 1.060883e-02, 1.069057e-02, 1.077293e-02, 1.085593e-02, 1.093957e-02, 1.102386e-02, 1.110879e-02, 1.119438e-02, 1.128062e-02, 1.136753e-02, 1.145511e-02, 1.154337e-02, 1.163230e-02, 1.172192e-02, 1.181224e-02, 1.190324e-02, 1.199495e-02, 1.208736e-02, 1.218049e-02, 1.227433e-02, 1.236890e-02, 1.246419e-02, 1.256022e-02, 1.265699e-02, 1.275450e-02, 1.285277e-02, 1.295179e-02, 1.305158e-02, 1.315213e-02, 1.325346e-02, 1.335557e-02, 1.345846e-02, 1.356215e-02, 1.366664e-02, 1.377193e-02, 1.387803e-02, 1.398495e-02, 1.409270e-02, 1.420127e-02, 1.431068e-02, 1.442093e-02, 1.453203e-02, 1.464399e-02, 1.475681e-02, 1.487050e-02, 1.498507e-02, 1.510051e-02, 1.521685e-02, 1.533408e-02, 1.545222e-02, 1.557127e-02, 1.569123e-02, 1.581212e-02, 1.593393e-02, 1.605669e-02, 1.618039e-02, 1.630505e-02, 1.643066e-02, 1.655725e-02, 1.668480e-02, 1.681334e-02, 1.694287e-02, 1.707340e-02, 1.720493e-02, 1.733748e-02, 1.747105e-02, 1.760564e-02, 1.774128e-02, 1.787795e-02, 1.801568e-02, 1.815447e-02, 1.829433e-02, 1.843527e-02, 1.857729e-02, 1.872041e-02, 1.886463e-02, 1.900996e-02, 1.915641e-02, 1.930398e-02, 1.945270e-02, 1.960255e-02, 1.975357e-02, 1.990574e-02, 2.005909e-02, 2.021362e-02, 2.036934e-02, 2.052626e-02, 2.068438e-02, 2.084373e-02, 2.100430e-02, 2.116611e-02, 2.132916e-02, 2.149347e-02, 2.165904e-02, 2.182589e-02, 2.199403e-02, 2.216346e-02, 2.233419e-02, 2.250624e-02, 2.267962e-02, 2.285432e-02, 2.303038e-02, 2.320779e-02, 2.338656e-02, 2.356672e-02, 2.374826e-02, 2.393120e-02, 2.411554e-02, 2.430131e-02, 2.448850e-02, 2.467714e-02, 2.486723e-02, 2.505878e-02, 2.525181e-02, 2.544633e-02, 2.564234e-02, 2.583986e-02, 2.603890e-02, 2.623948e-02, 2.644160e-02, 2.664527e-02, 2.685052e-02, 2.705734e-02, 2.726575e-02, 2.747577e-02, 2.768741e-02, 2.790068e-02, 2.811558e-02, 2.833215e-02, 2.855037e-02, 2.877028e-02, 2.899189e-02, 2.921519e-02, 2.944022e-02, 2.966698e-02, 2.989548e-02, 3.012575e-02, 3.035778e-02, 3.059160e-02, 3.082722e-02, 3.106466e-02, 3.130392e-02, 3.154502e-02, 3.178798e-02, 3.203281e-02, 3.227953e-02, 3.252814e-02, 3.277866e-02, 3.303112e-02, 3.328551e-02, 3.354187e-02, 3.380019e-02, 3.406051e-02, 3.432282e-02, 3.458716e-02, 3.485353e-02, 3.512195e-02, 3.539243e-02, 3.566500e-02, 3.593966e-02, 3.621644e-02, 3.649534e-02, 3.677639e-02, 3.705961e-02, 3.734500e-02, 3.763259e-02, 3.792239e-02, 3.821442e-02, 3.850869e-02, 3.880523e-02, 3.910405e-02, 3.940517e-02, 3.970861e-02, 4.001438e-02, 4.032250e-02, 4.063299e-02, 4.094587e-02, 4.126115e-02, 4.157886e-02, 4.189901e-02, 4.222163e-02, 4.254672e-02, 4.287432e-02, 4.320443e-02, 4.353709e-02, 4.387230e-02, 4.421008e-02, 4.455047e-02, 4.489347e-02, 4.523911e-02, 4.558740e-02, 4.593837e-02, 4.629204e-02, 4.664843e-02, 4.700756e-02, 4.736945e-02, 4.773412e-02, 4.810159e-02, 4.847189e-02, 4.884503e-02, 4.922104e-02, 4.959994e-02, 4.998175e-02, 5.036649e-02, 5.075419e-02, 5.114487e-02, 5.153855e-02, 5.193526e-02, 5.233501e-02, 5.273783e-02, 5.314375e-02, 5.355279e-02, 5.396496e-02, 5.438030e-02, 5.479883e-02, 5.522058e-02, 5.564556e-02, 5.607381e-02, 5.650535e-02, 5.694020e-02, 5.737838e-02, 5.781993e-02, 5.826487e-02, 5.871323e-02, 5.916503e-02, 5.962029e-02, 6.007905e-02, 6.054133e-02, 6.100716e-02, 6.147656e-02, 6.194956e-02, 6.242619e-02, 6.290648e-02, 6.339045e-02, 6.387814e-02, 6.436956e-02, 6.486476e-02, 6.536375e-02, 6.586657e-02, 6.637324e-02, 6.688380e-02, 6.739828e-02, 6.791669e-02, 6.843909e-02, 6.896548e-02, 6.949591e-02, 7.003041e-02, 7.056900e-02, 7.111171e-02, 7.165859e-02, 7.220966e-02, 7.276494e-02, 7.332448e-02, 7.388831e-02, 7.445645e-02, 7.502895e-02, 7.560583e-02, 7.618712e-02, 7.677287e-02, 7.736309e-02, 7.795784e-02, 7.855714e-02, 7.916102e-02, 7.976952e-02, 8.038268e-02, 8.100053e-02, 8.162311e-02, 8.225045e-02, 8.288258e-02, 8.351955e-02, 8.416139e-02, 8.480813e-02, 8.545982e-02, 8.611649e-02, 8.677817e-02, 8.744491e-02, 8.811675e-02, 8.879372e-02, 8.947585e-02, 9.016320e-02, 9.085579e-02, 9.155368e-02, 9.225689e-02, 9.296546e-02, 9.367945e-02, 9.439888e-02, 9.512380e-02, 9.585424e-02, 9.659026e-02, 9.733190e-02, 9.807918e-02, 9.883216e-02, 9.959088e-02, 1.003554e-01, 1.011257e-01, 1.019019e-01, 1.026840e-01, 1.034721e-01, 1.042661e-01, 1.050662e-01, 1.058724e-01, 1.066848e-01, 1.075033e-01, 1.083280e-01, 1.091590e-01, 1.099963e-01, 1.108400e-01, 1.116901e-01, 1.125467e-01, 1.134097e-01, 1.142794e-01, 1.151556e-01, 1.160385e-01, 1.169280e-01, 1.178243e-01, 1.187275e-01, 1.196374e-01, 1.205543e-01, 1.214781e-01, 1.224090e-01, 1.233468e-01, 1.242918e-01, 1.252439e-01, 1.262033e-01, 1.271699e-01, 1.281438e-01, 1.291251e-01, 1.301138e-01, 1.311099e-01, 1.321136e-01, 1.331249e-01, 1.341438e-01, 1.351705e-01, 1.362048e-01, 1.372470e-01, 1.382970e-01, 1.393550e-01, 1.404209e-01, 1.414948e-01, 1.425769e-01, 1.436670e-01, 1.447654e-01, 1.458721e-01, 1.469871e-01, 1.481104e-01, 1.492422e-01, 1.503825e-01, 1.515314e-01, 1.526889e-01, 1.538551e-01, 1.550300e-01, 1.562137e-01, 1.574063e-01, 1.586078e-01, 1.598184e-01, 1.610379e-01, 1.622666e-01, 1.635045e-01, 1.647517e-01, 1.660081e-01, 1.672740e-01, 1.685493e-01, 1.698341e-01, 1.711284e-01, 1.724324e-01, 1.737462e-01, 1.750697e-01, 1.764030e-01, 1.777463e-01, 1.790995e-01, 1.804628e-01, 1.818362e-01, 1.832197e-01, 1.846136e-01, 1.860177e-01, 1.874323e-01, 1.888573e-01, 1.902929e-01, 1.917390e-01, 1.931958e-01, 1.946634e-01, 1.961418e-01, 1.976311e-01, 1.991314e-01, 2.006427e-01, 2.021650e-01, 2.036986e-01, 2.052435e-01, 2.067996e-01, 2.083672e-01, 2.099462e-01, 2.115368e-01, 2.131391e-01, 2.147530e-01, 2.163787e-01, 2.180162e-01, 2.196657e-01, 2.213272e-01, 2.230008e-01, 2.246865e-01, 2.263844e-01, 2.280947e-01, 2.298174e-01, 2.315525e-01, 2.333001e-01, 2.350604e-01, 2.368333e-01, 2.386191e-01, 2.404176e-01, 2.422292e-01, 2.440537e-01, 2.458913e-01, 2.477420e-01, 2.496060e-01, 2.514834e-01, 2.533741e-01, 2.552783e-01, 2.571960e-01, 2.591274e-01, 2.610725e-01, 2.630313e-01, 2.650041e-01, 2.669908e-01, 2.689915e-01, 2.710063e-01, 2.730353e-01, 2.750785e-01, 2.771361e-01, 2.792081e-01, 2.812946e-01, 2.833957e-01, 2.855114e-01, 2.876418e-01, 2.897870e-01, 2.919471e-01, 2.941222e-01, 2.963122e-01, 2.985174e-01, 3.007378e-01, 3.029734e-01, 3.052243e-01, 3.074906e-01, 3.097725e-01, 3.120698e-01, 3.143828e-01, 3.167115e-01, 3.190559e-01, 3.214162e-01, 3.237923e-01, 3.261845e-01, 3.285926e-01, 3.310169e-01, 3.334574e-01, 3.359141e-01, 3.383872e-01, 3.408766e-01, 3.433824e-01, 3.459047e-01, 3.484436e-01, 3.509992e-01, 3.535714e-01, 3.561603e-01, 3.587661e-01, 3.613887e-01, 3.640282e-01, 3.666846e-01, 3.693581e-01, 3.720487e-01, 3.747564e-01, 3.774812e-01, 3.802233e-01, 3.829826e-01, 3.857592e-01, 3.885531e-01, 3.913645e-01, 3.941932e-01, 3.970394e-01, 3.999031e-01, 4.027843e-01, 4.056830e-01, 4.085994e-01, 4.115333e-01, 4.144848e-01, 4.174540e-01, 4.204408e-01, 4.234454e-01, 4.264676e-01, 4.295075e-01, 4.325651e-01, 4.356404e-01, 4.387334e-01, 4.418441e-01, 4.449725e-01, 4.481186e-01, 4.512824e-01, 4.544638e-01, 4.576629e-01, 4.608796e-01, 4.641139e-01, 4.673658e-01, 4.706351e-01, 4.739220e-01, 4.772263e-01, 4.805480e-01, 4.838870e-01, 4.872434e-01, 4.906169e-01, 4.940076e-01, 4.974154e-01, 5.008402e-01, 5.042819e-01, 5.077404e-01, 5.112157e-01, 5.147076e-01, 5.182161e-01, 5.217409e-01, 5.252821e-01, 5.288395e-01, 5.324129e-01, 5.360022e-01, 5.396072e-01, 5.432279e-01, 5.468640e-01, 5.505154e-01, 5.541820e-01, 5.578634e-01, 5.615596e-01, 5.652703e-01, 5.689953e-01, 5.727344e-01, 5.764874e-01, 5.802541e-01, 5.840341e-01, 5.878273e-01, 5.916334e-01, 5.954521e-01, 5.992830e-01, 6.031260e-01, 6.069808e-01, 6.108469e-01, 6.147240e-01, 6.186119e-01, 6.225102e-01, 6.264184e-01, 6.303363e-01, 6.342634e-01, 6.381993e-01, 6.421436e-01, 6.460958e-01, 6.500556e-01, 6.540225e-01, 6.579959e-01, 6.619754e-01, 6.659605e-01, 6.699506e-01, 6.739452e-01, 6.779438e-01, 6.819458e-01, 6.859505e-01, 6.899575e-01, 6.939659e-01, 6.979753e-01, 7.019849e-01, 7.059941e-01, 7.100021e-01, 7.140082e-01, 7.180117e-01, 7.220118e-01, 7.260077e-01, 7.299987e-01, 7.339838e-01, 7.379622e-01, 7.419331e-01, 7.458955e-01, 7.498485e-01, 7.537912e-01, 7.577226e-01, 7.616417e-01, 7.655474e-01, 7.694387e-01, 7.733146e-01, 7.771738e-01, 7.810154e-01, 7.848381e-01, 7.886406e-01, 7.924219e-01, 7.961807e-01, 7.999156e-01, 8.036253e-01, 8.073086e-01, 8.109640e-01, 8.145901e-01, 8.181855e-01, 8.217488e-01, 8.252783e-01, 8.287726e-01, 8.322301e-01, 8.356492e-01, 8.390283e-01, 8.423656e-01, 8.456595e-01, 8.489082e-01, 8.521099e-01, 8.552628e-01, 8.583651e-01, 8.614148e-01, 8.644101e-01, 8.673489e-01, 8.702292e-01, 8.730490e-01, 8.758063e-01, 8.784988e-01, 8.811245e-01, 8.836811e-01, 8.861664e-01, 8.885782e-01, 8.909142e-01, 8.931719e-01, 8.953490e-01, 8.974431e-01, 8.994518e-01, 9.013725e-01, 9.032027e-01, 9.049399e-01, 9.065815e-01, 9.081249e-01, 9.095673e-01, 9.109062e-01, 9.121388e-01, 9.132623e-01, 9.142740e-01, 9.151711e-01, 9.159508e-01, 9.166101e-01, 9.171463e-01, 9.175565e-01, 9.178378e-01, 9.179872e-01, 9.180018e-01, 9.178787e-01, 9.176149e-01, 9.172076e-01, 9.166536e-01, 9.159501e-01, 9.150942e-01, 9.140828e-01, 9.129131e-01, 9.115821e-01, 9.100870e-01, 9.084249e-01, 9.065930e-01, 9.045884e-01, 9.024084e-01, 9.000503e-01, 8.975113e-01, 8.947889e-01, 8.918805e-01, 8.887837e-01, 8.854959e-01, 8.820149e-01, 8.783384e-01, 8.744642e-01, 8.703902e-01, 8.661146e-01, 8.616355e-01, 8.569511e-01, 8.520599e-01, 8.469604e-01, 8.416513e-01, 8.361314e-01, 8.303998e-01, 8.244557e-01, 8.182985e-01, 8.119276e-01, 8.053429e-01, 7.985444e-01, 7.915322e-01, 7.843067e-01, 7.768687e-01, 7.692189e-01, 7.613587e-01, 7.532893e-01, 7.450125e-01, 7.365303e-01, 7.278449e-01, 7.189590e-01, 7.098753e-01, 7.005971e-01, 6.911279e-01, 6.814716e-01, 6.716322e-01, 6.616143e-01,6.514228e-01,6.410629e-01,6.305401e-01,6.198603e-01,6.090297e-01,5.980551e-01,5.869434e-01,5.757019e-01,5.643382e-01,5.528605e-01,5.412770e-01,5.295965e-01,5.178279e-01,5.059807e-01,4.940644e-01,4.820891e-01,4.700649e-01,4.580023e-01,4.459120e-01,4.338051e-01,4.216926e-01,4.095859e-01,3.974965e-01,3.854361e-01,3.734163e-01,3.614491e-01,3.495463e-01,3.377198e-01,3.259814e-01,3.143430e-01,3.028163e-01,2.914130e-01,2.801445e-01,2.690220e-01,2.580567e-01,2.472591e-01,2.366400e-01,2.262092e-01,2.159765e-01,2.059513e-01,1.961424e-01,1.865581e-01,1.772062e-01,1.680940e-01,1.592282e-01,1.506148e-01,1.422594e-01,1.341665e-01,1.263403e-01,1.187842e-01,1.115008e-01,1.044921e-01,9.775930e-02,9.130286e-02,8.512255e-02,7.921742e-02,7.358577e-02,6.822524e-02,6.313278e-02,5.830467e-02,5.373656e-02,4.942353e-02,4.536004e-02,4.154006e-02,3.795704e-02,3.460399e-02,3.147351e-02,2.855783e-02,2.584889e-02,2.333833e-02,2.101761e-02,1.887801e-02,1.691069e-02,1.510676e-02,1.345729e-02,1.195341e-02,1.058629e-02,9.347244e-03,8.227734e-03,7.219415e-03,6.314173e-03,5.504154e-03,4.781787e-03,4.139813e-03,3.571302e-03,3.069668e-03,2.628682e-03,2.242478e-03,1.905562e-03,1.612808e-03,1.359460e-03,1.141123e-03,9.537575e-04,7.936688e-04,6.574939e-04,5.421874e-04,4.450058e-04,3.634899e-04,2.954477e-04,2.389353e-04,1.922383e-04,1.538533e-04,1.224694e-04,9.694981e-05,7.631480e-05,5.972488e-05,4.646519e-05,3.593070e-05,2.761261e-05,2.108580e-05,1.599737e-05,1.205639e-05,9.024603e-06,6.708294e-06,4.951062e-06,3.627559e-06,2.638069e-06,1.903872e-06,1.363300e-06,9.684284e-07,6.823153e-07,4.767173e-07,3.302248e-07,2.267485e-07,1.543035e-07,1.040430e-07,6.949640e-08,4.597571e-08,3.011714e-08,1.953071e-08,1.253542e-08,7.961081e-09,5.001613e-09,3.107731e-09,1.909237e-09,1.159431e-09,6.957938e-10,4.125220e-10,2.415580e-10,1.396618e-10,7.970527e-11,4.488671e-11,2.493648e-11,1.366159e-11,7.378610e-12,3.927453e-12,2.059490e-12,1.063599e-12,5.407576e-13,2.705689e-13,1.331809e-13};

/* ==========  begin the actual calculations here  ========== */

    
   
    
/* initial conditions */

   gb[0]=g_bulk;
   vb[0]=c*sqrt(1.0-1.0/(gb[0]*gb[0]));

   
   t[0]=r[0]/vb[0];
   tobs[0]=epsilon;
   tcom[0] = (tobs[0]/(1+z)*vb[0]/c/(1-vb[0]/c))/g_bulk;
   tcom_spec = (tspec/(1+z)*vb[0]/c/(1-vb[0]/c))/g_bulk;
    tobs_end = t_end*g_bulk*(1-vb[0]/c)*c/vb[0]*(1+z);
   log10tobs[0]=log10(tobs[0]);

   jm = findindex(log10ges, log10gm, j5max);
   j_u[0] = jm;
   /*printf("tcom = %le, B1 = %le, B1 = %le dt = %le\n",tcom[0], sqrt((LB_0 - E_inj_rec*t_rec*(exp(tcom[0]/t_rec) -1.0)/Nrec_tot)/(g_bulk*g_bulk*pow(R0 + g_bulk*c*tcom[0],2.0)*c*Omega_jet)),B_decay(2.999975e-07),h1(tcom[0], B_decay(tcom[0])));
   printf("jm = %d\n", jm);*/
    
  
   g_u[0] = ges[jm];
   ges_u[0] = pow(10.0, log10gm);
   for(j5 = 0; j5<=400; j5++)
   {ne[0][j5] = 1.0;}
    time_t start,end;
    start =time(NULL);//or time(&start);
    i_t = 0;
    
   for(loop=0;loop<n;loop++)
   {   for(j5 = 0; j5<=400; j5++)
       {ne[1][j5] = ne[0][j5];}
       gb[1]=gb[0];
       vb[1]=c*sqrt(1.0-1.0/(gb[1]*gb[1]));
       tcom[1] = tcom[0];
       B[1]=B_decay(tcom[1]);
       dtcom=h1(tcom[1], B[1]);
       j_u[1]= j_u[0];
       g_u[1]=g_u[0];
       tobs[1]=tobs[0]+dtcom/2.0/gb[1]*(1.0+z); /* dtobs ~ dt/2/Gamma^2*(1+z) */
       
       log10r[1]=log10(r[1]);
       log10t[1]=log10(t[1]);
       log10tobs[1]=log10(tobs[1]);
       
       for(j5 = 0; j5<=j5max-1; j5++)
       {
           if(j5 <= j_u[1])
           {ne[0][j5] = 1.0;}
           if(j5 < jm &&  j5 > j_u[1])
           {
               k1 = -(g_x_t(ges[j5+1], B[1], tcom[1])*ne[1][j5+1] - g_x_t(ges[j5], B[1], tcom[1])*ne[1][j5])/(dd*log(10.0)*ges[j5]);
               k2 = k1 + 1.0/2.0*k1*dtcom;
               k3 = k1 + 1.0/2.0*k2*dtcom;
               k4 = k1 + 1.0/2.0*k3*dtcom;
               ne[0][j5] = 1.0/6.0*(k1+2*k2+2*k3+k4)*dtcom+ne[1][j5];
           }
           if(j5>=jm)
           {
               k1 = (Qx(ges[j5], tcom[1], tobs[1]) - (g_x_t(ges[j5+1], B[1], tcom[1])*ne[1][j5+1] - g_x_t(ges[j5],B[1], tcom[1])*ne[1][j5])/(dd*log(10.0)*ges[j5]));
               k2 = k1 + 1.0/2.0*k1*dtcom;
               k3 = k1 + 1.0/2.0*k2*dtcom;
               k4 = k1 + 1.0/2.0*k3*dtcom;
               ne[0][j5] = 1.0/6.0*(k1+2*k2+2*k3+k4)*dtcom+ne[1][j5];
           }

       }
       
       if(tcom[1] >= t_p_Ea_M[theta_length-i_t] && tcom[1] <= t_p_Ea_M[0])
       { for(j5 = 0; j5<=j5max-1; j5++)
           {
            ne_EA[theta_length-i_t][j5] = ne[0][j5];
            
           }
           i_t = i_t + 1;
       }
           
       ne[0][j5max] = pow(10,(2.0*log10(ne[0][j5max-1])-log10(ne[0][j5max-2])));
       dg = g_x_t(g_u[1], B[1], tcom[1])*dtcom;
       g_u[0] = g_u[1] + dg;
       j_u[0] = findindex(log10ges, log10(g_u[0]), j5max);
       /*printf("jm = %f\n%f\n", j_u[0],dg);*/

       if(tcom[1] < tcom_spec) goto skip;
     /*  printf("gesju0 = %le\n", ges[j_u[0]]);
       printf("Q = %le\n", Qx(6.918*10.0, 8.0*pow(10.0,3.0), tobs[1]));
       printf("gesj5 = %le, %le\n", ges[j5max], tcom_spec);
       for(j5 = 0; j5<j5max; j5++)
       {
       printf("%le, ", ne[0][j5]);}
       printf("\n %d\n",j_u[1]);
       printf("\ntheta_length = %d\n",theta_length);
       printf("%f\n %f\n",g_x_t(log10ges[j5+1],B[1], tcom[1]), tcom[1]);
       printf("loop = %d\n", loop);
       printf("k = %le\n， %le, %le, %le, %le\n,%d, %d, %d, %le\n", k1,k2,k3,k4,dtcom,j5max,j_u[0],jm,B[1]);*/
       

       log10xxmax=1.5;
       log10xxmin=-8.0;
       nu_tem = 3.0*e/(4.0*pi*me*c);
       dFnu_tem = (1+z)/(4.0*pi*D*D)*sqrt(3.0)*pow(e,3.0)/(me*c*c);
       
      /* printf("nu_tem = %le\n", nu_tem);*/
       
       for(j2=0;j2<=argc-input_number;j2++)
       { Fnuobs = 0.0;
           
           for(th1=0;th1<theta_length;th1++)
            {
              for(j5=1;j5<=j5max;j5++)
                {
                 nu_c = nu_tem*B_decay(t_p_Ea_M[th1])*(ges[j5]*ges[j5]);
                 dFnumax = dFnu_tem*B_decay(t_p_Ea_M[th1])*ne_EA[th1][j5];
                     log10xx_tem=log10(nup[j2][th1]/nu_c);
                     i0=(int)(Ncell*(log10xx_tem-log10xxmin)/(log10xxmax-log10xxmin));
                     if(log10xx_tem > log10xxmin && log10xx_tem < log10xxmax)
                         dFnu=dFnumax*Fxx[i0]*ges[j5]*log(10)*dd*pow(Dop(theta[th1]), 3.0)*sin(theta[th1])*dtheta*2.0*pi;
                     if(log10xx_tem <= log10xxmin) dFnu=dFnumax*2.14953*pow(nup[j2][th1]/nu_c,1.0/3.0)*ges[j5]*log(10.0)*dd*pow(Dop(theta[th1]), 3.0)*sin(theta[th1])*dtheta*2.0*pi;
                     if(log10xx_tem >= log10xxmax) dFnu=0.0;
                         Fnuobs=Fnuobs+dFnu;
                     
                 }
             }
         
           Fnuobs=Fnuobs*pow(10.0,26.0);
           F[j2] = Fnuobs;
           printf("%le\n",Fnuobs);
       }
       
       goto end;
       skip:

       t[0]=t[1];
       tobs[0]=tobs[1];
       log10r[0]=log10r[1];
       log10tobs[0]=log10tobs[1];
       tcom[0] = tcom[1] +dtcom;
       /*tcom[0] = (tobs[1]/(1+z)*vb[1]/c/(1-vb[1]/c))/g_bulk;*/
       gb[0]=gb[1];
       vb[0]=vb[1];
       B[0]=B[1];
       


           
       
   }
   
   end:
    
   /* printf("%le\n",tcom[0]);
    printf("B = %le\n", B[1]);
     printf("dt = %le\n", dtcom);
    
    
    for(j2=0;j2<=argc-input_number;j2++)
   {
      nuobs[j2] = nuobs[j2]*Para_Hz2KeV;
       nuobs[j2] = nuobs[j2];
   }
    FILE *fp;
    fp = fopen("F.txt","w");
    for(j2=0;j2<=argc-input_number;j2++)
    {
        fprintf(fp, "%le      \t             %le\n",nuobs[j2], F[j2]);
    }
    
    fclose(fp);
    printf("%d\n",j5max );
    
    FILE *ft;
    ft = fopen("ne.txt","w");
    for(j5 = 0; j5<j5max; j5++)
    {
        fprintf(ft, "%le  \t     %le\n", log10ges[j5], ne[0][j5]);
    }
    fclose(ft);
    
    FILE *fq;
    fq = fopen("t_p_Ea_M.txt","w");
    for(th1 = 0; th1<theta_length; th1++)
    {
        for(j5 = 0; j5<j5max-1; j5++)
     {
         fprintf(fq, "%le   ", ne_EA[th1][j5]);
     }
        fprintf(fq, "%le\n", t_p_Ea_M[th1]);
    }
    fclose(ft);*/
    

  /*close all the files that have been opened */

   // fcloseall( );


/* free all the pointers that have been used for 1d arrays */

   free(tcom),free(dN),free(ginj);


/* free all the pointers that have been used for 2d arrays */

 
    end =time(NULL);
    /*printf("time=%f\n",difftime(end,start));*/
wrong:
    if(option == 100 ) printf("We have no this model, please choose again.");
   return(0);
}

